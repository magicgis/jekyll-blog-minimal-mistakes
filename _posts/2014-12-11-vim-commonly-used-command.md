---
layout: post
title: "vim 常用命令备忘"
categories: 技术
tags: Vim
---


---

使用 <strong>Vim</strong> 的时间不长，但如今已经离不开熟悉的 <strong>Vim</strong> 编辑模式了。 <strong>Vim</strong> 的学习曲线是非常陡的，一开始学习的时候，面对很多的操作命令要去记住，常常望而却步。

其实，只要记住一些常用的命令，加之在工作中坚持使用 <strong>Vim</strong> 进行编辑，很快就能得心应手了。

### 光标移动(Cursor Movement)

|命令       | 作用（解释）                                |
------------|---------------------------------------------|
|h,j,k,l    | h表示往左，j表示往下，k表示往右，l表示往上  |
|Ctrl+f     | 上一页                                      |
|Ctrl+b     | 下一页                                      |
|w, e, W, E | 跳到单词的后面，小写包括标点                |
|b, B       | 以单词为单位往前跳动光标，小写包含标点      |
|O          | 开启新的一行                                |
|^          | 一行的开始                                  |
|$          | 一行的结尾                                  |
|gg         | 文档的第一行                                |
|[N]G       | 文档的第N行或者最后一行                     |



### 插入模式(Insert Mode)


|   命令  |   作用（解释)  |
------------|----------------
| a         | 在当前光标位置的右边添加文本                   |
| i         | 在当前光标位置的左边添加文本                   |
| A         | 在当前行的末尾位置添加文本                     |
| I         | 在当前行的开始处添加文本(非空字符的行首)       |
| O         | 在当前行的上面新建一行                         |
| o         | 在当前行的下面新建一行                         |
| R         | 替换(覆盖)当前光标位置及后面的若干文本         |
| J         | 合并光标所在行及下一行为一行(依然在命令模式)   |


### 编辑(Editing)


|   命令  |   作用（解释）  |
------------|----------------
|   r   |   在插入模式替换光标所在的一个字符    |
|   J   |   合并下一行到上一行   |
|   s   |   删除光标所在的一个字符, 光标还在当行 |
|   S   |   删除光标所在的一行，光标还在当行，不同于dd  |
|   u   |   撤销上一步操作 |
|   ctrl+r  |   恢复上一步操作 |
|   .   |   重复最后一个命令    |
|   ~   |   变换为大写   |
|   [N]>>   |   一行或N行往右移动一个tab  |
|   [N]<<   |   一行或N行往左移动一个tab  |

### 替换

|   命令  |   作用（解释）  |
------------|----------------
|:s/old/new        | 用new替换行中首次出现的old   |
|:s/old/new/g      | 用new替换行中所有的old |
|:n,m s/old/new/g  | 用new替换从n到m行里所有的old |
|:%s/old/new/g     | 用new替换当前文件里所有的old  |

举例，删除16行之后的所有内容
```
:16,$ d
```

### 关闭(Exiting)


|   命令  |   作用（解释)  |
------------|----------------
|   :w  |   保存  |
|   :wq, :x |   保存并关闭   |
|   :q  |   关闭（已保存） |
|   :q! |   强制关闭    |


### 搜索(Search)

|   命令  |   作用（解释)  |
------------|----------------
|   /pattern    |   搜索（非插入模式)   |
|   ?pattern    |   往后搜索    |
|   n   |   光标到达搜索结果的前一个目标  |
|   N   |   光标到达搜索结果的后一个目标  |

### 视觉模式(Visual Mode)

|   命令  |   作用（解释)  |
------------|----------------
|   v   |   选中一个或多个字符   |
|   V   |   选中一行    |

### 剪切和复制(Cut and Paste)


|   命令  |   作用（解释)  |
------------|----------------
|   dd  |   删除一行    |
|   dw  |   删除一个单词  |
|   x   |   删除后一个字符 |
|   X   |   删除前一个字符 |
|   D   |   删除一行最后一个字符  |
|   [N]yy   |   复制一行或者N行    |
|   p   |   粘贴  |

|   补充命令    |   作用（解释)  |
----------------|----------------
|yy     |   将当前行复制到缓存区，也可以用 "ayy 复制，"a 为缓冲区，a也可以替换为a到z的任意字母，可以完成多个复制任务  |
|nyy    |   将当前行向下n行复制到缓冲区，也可以用 "anyy 复制，"a 为缓冲区，a也可以替换为a到z的任意字母，可以完成多个复制任务 |
|yw     |   复制从光标开始到词尾的字符   |
|nyw    |   复制从光标开始的n个单词    |
|y^     |   复制从光标到行首的内容 |
|y$     |   复制从光标到行尾的内容 |
|p      |   粘贴剪切板里的内容在光标后，如果使用了前面的自定义缓冲区，建议使用"ap 进行粘贴   |
|P      |   粘贴剪切板里的内容在光标前，如果使用了前面的自定义缓冲区，建议使用"aP 进行粘贴   |


### 窗口操作


|   命令  |   作用（解释)  |
------------|----------------
|   :split  |   水平方向分割出一个窗口 |
|   :vsplit |   垂直方向分割出一个窗口 |
|   :close  |   关闭窗口    |
|   Ctrl+W  |   切换窗口, h到左边窗口，j到下方窗口，k到上方窗口，l到右边窗口   |

### 其他

|   命令  |   作用（解释)  |
------------|----------------
|:set fileformat=unix   | 将文件修改为unix格式，如win下面的文本文件在linux下会出现^M |
|:set  nu               | 显示行号 |
|:set nonu              | 取消显示行号 |

### vim的modelines模式

有些VIM插件的配置中，在末尾有类似这样一串字符：

/* vim: set expandtab ts=4 sw=4 sts=4 tw=100: */

在文件末尾的这段注释是有作用的，这是vim的modeline模式，在”vim:”后面跟的这段命令，在你用vim打开这个文件的时候，这段命令会执行。也就是说，例如背景里这个例子，当你用vim打开这个文件的时候，那

set expandtab ts=4 sw=4 sts=4 tw=100

这段vim命令会被执行。

那这样做有什么作用呢，在modeline模式保存一些最基本的格式命令，可以让后来修改这个文件的人保持和创建这个文件人的格式一致，不会因为vim的配置不一样的原因而不一致。也就是说，比如创建人设置的就是用4个空格代替一个tab，那后来修改这个文件的人，即使在vimrc里没有配置，也一样会用4个空格代替一个tab。这就是我想到的一点，可能会有其他作用，我木想到。。不过对于不了解的人来说，这确实是一个坑。。比如，我就郁闷了半天为什么我在vimrc设置的空格代替tab不生效了。。。

[原文链接](http://www.log4myself.com/archives/298)

vim的modeline可以让你针对每个文件进行文件级别的设置，这些设置是覆盖当前用户的vimrc中的设置的。vim默认关闭modeline，开启的话需要在你的home下的.vimrc文件中增加一行：

set modeline

然后source一下或者重新登陆就可以生效了。

modeline 里可以放的指令不限一个，所以我.py 档案在档尾都有这麽一行的 modeline

```vim: set ai et nu sw=4 ts=4 tw=79:```

然后创建或打开一个文件，在文件的首行/尾行（必须），写一行当前这个文件里面语言所支持的注释，例如写python就是#，写php就//或/**/，然后在里面加上modeline识别的固定格式，举例：

```vim: set expandtab ts=4 sts=4 sw=4 :```

这句注释中，'#'后面、"vim:"前面的空格是必须的，结尾的':'也是必须的，这些是modeline所识别的。中间就是你所熟悉的vimrc中的设置了。上面这样的设置使得这个文件在打开编辑时默认为使用空格展开\t，并且一个\t输出的长度为4个空格。

再举例一个thrift类型的文件设置：

```
/** vim: set filetype=java ts=2 sts=2 sw=2 fdm=indent et : */
```

因为vim暂时没有支持.thrift这个filetype，并且thrift中的习惯缩进长度一般为2。设置成java的filetype来编辑thrift文件还不错，/**/注释在回车时还能自动生成*号。后面set的一串2，就能满足thrift的缩进习惯。

<br />

### 多文件编辑

在linux下，假若需要对多个文件的内容进行相互对照和参考，或需要将一个文件的某部分内容复制或粘贴到另一个文件中，可通过vim同时打开这些相关文件进行编辑。

通过vim打开的每个文件都对应着一个buffer（buffer是系统为打开的文件分配的内存空间），每个buffer都有一个id。

1.在同一窗口下显示多个文件

命令：

vim filename1 filename2

说明：上述命令同时打开了filename1，filename2两个文件，不过文件filename1的内容将占据整个vim窗口，要想在各个文件之间进行切换，我们可通过如下命令

:n    切换到下一个文件

:N   切换到上一个文件

:n filename2   切换到文件filename2

我们提到每个打开的文件都对应着一个buffer，故可通过切换buffer来达到切换文件的目的，如下

:ls  列出vim打开的所有文件的信息，包括文件名，buffer id等

:b2  切换到buffer id为2的buffer

:bn   切换到当前buffer的下一个buffer

:bp   切换当前buffer的前一个buffer

:bd 关闭当前buffer，对应文件也随之关闭

:bd2 关闭buffer id为2的buffer，对应文件也随之关闭

我们可通过安装miniBufExplorer插件来简化buffer的切换。不过该插件有时会导致语法高亮显示失效，我们可通过命令:syntax on来恢复高亮。

2.分割窗口，显示多个文件

对于在同一个窗口下打开多个文件，对于各文件之间内容的复制，剪切操作终究不方便，我们可使用命令对窗口进行分割，每个子窗口显示一个文件

命令：

vim  -o filename1 filename2  水平分割窗口

vim  -O  filename1 filename2 垂直分割窗口

我们可按ctrl ww在各窗口之间进行切换。

通过该种方式可非常方便各文件内容之间的复制与剪切操作。

### Vim进阶

参考链接：

[简明 Vim 练级攻略](http://coolshell.cn/articles/5426.html)

[用Vim编程——配置与技巧](http://linux-wiki.cn/wiki/zh-hans/%E7%94%A8Vim%E7%BC%96%E7%A8%8B%E2%80%94%E2%80%94%E9%85%8D%E7%BD%AE%E4%B8%8E%E6%8A%80%E5%B7%A7)

[NERDtree插件](http://www.cnblogs.com/openusb/archive/2012/12/13/2815896.html)